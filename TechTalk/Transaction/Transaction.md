# 트랜잭션이란?

1. 여러 쿼리를 논리적으로 하나의 작업 단위로 묶는 것
2. 더 이상 나눌 수 없는 가장 작은 하나의 단위
3. 데이터베이스에서 수행되는 여러 작업을 하나의 논리적 단위로 수행하는 것

## 트랜잭션 예시 

> A가 B에게 돈 1000원을 이체하는 경우

```
-- 첫번째 경우

UPDATE accounts
SET money = money - 1000
WHERE user = 'A'

-- 두번째 경우

UPDATE accounts
SET money = money + 1000
WHERE user = 'B'
```

> 위와 같은 경우 오류없이 성공적으로 실행되면 트랜잭션 연산에서는 COMMIT  
> B case에서 오류가 나는 경우 A는 입금하고 B는 0원이 됨.  
> 따라서 A에서 B로 10만원을 보내지 않았기때문에 ROLLBACK  

## ACID

**트랜잭션이 안전하게 수행된다는 것을 보장하기 위한 성질**
  
* Atomicity (원자성)
  * 특정 트랜잭션안에 모든 트랜잭션이 수행되거나 수행되지 않는 것
* Consistency (일관성)
  * 데이터 무결성 제약조건에 맞춰야하는 것
* Isolation (고립성)
  * 어떤 트랜잭션에서 수행되면 영향을 주거나 받지 않는 것
* Durability (지속성)
  * 트랜잭션이 성공적으로 수행되면 데이터베이스에 반영이 되어야하는 것

## Isolation Level

**10만개의 데이터 수행하는 경우**

* READ-UNCOMMITED
  * 아직 커밋되지 않은 데이터를 읽을 수 있음.
  * ROLLBACK이 발생하는 경우?
  * 특정 트랜잭션에서 데이터를 변경했지만 커밋되지 않았을 때, 다른 트랜잭션이 해당 값을 조회할 수 있는 Dirty Read 문제 발생.
* READ-COMMITTED
  * 커밋된 데이터만 읽을 수 있음. (Dirty Read) 문제 해결 가능.
  * 트랜잭션 내에서 같은 데이터를 여러 번 조회할 때 읽은 데이터가 서로 다른 값으로 나오는 Non-Repeatable-Read 문제 발생.
* REPEATABLE-READ
  * 특정 데이터를 반복 조회시 같은 값은 반환함.
  * 새로운 데이터가 생기거나, 기존의 데이터가 사라지는 Phantom-Read 문제 발생
* SERIALIZABLE
  * 고립성을 만족하는 마지막 절차.
  * 트랜잭션이 순차적으로 실행됨.
